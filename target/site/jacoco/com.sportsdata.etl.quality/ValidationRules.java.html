<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ValidationRules.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Sports Data ETL Pipeline</a> &gt; <a href="index.source.html" class="el_package">com.sportsdata.etl.quality</a> &gt; <span class="el_source">ValidationRules.java</span></div><h1>ValidationRules.java</h1><pre class="source lang-java linenums">package com.sportsdata.etl.quality;

import com.sportsdata.etl.models.Game;
import com.sportsdata.etl.models.Player;
import com.sportsdata.etl.models.Team;
import org.springframework.stereotype.Component;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;
import java.util.Set;

@Component
<span class="nc" id="L15">public class ValidationRules {</span>
    
<span class="nc" id="L17">    private static final Set&lt;String&gt; VALID_POSITIONS = Set.of(</span>
        &quot;Point Guard&quot;, &quot;PG&quot;, &quot;Shooting Guard&quot;, &quot;SG&quot;, &quot;Small Forward&quot;, &quot;SF&quot;, 
        &quot;Power Forward&quot;, &quot;PF&quot;, &quot;Center&quot;, &quot;C&quot;, &quot;Forward&quot;, &quot;Guard&quot;
    );
    
<span class="nc" id="L22">    private static final Set&lt;String&gt; VALID_GAME_STATUSES = Set.of(</span>
        &quot;Scheduled&quot;, &quot;Live&quot;, &quot;Final&quot;, &quot;Postponed&quot;, &quot;Cancelled&quot;
    );
    
    private static final int MIN_PLAYER_AGE = 16;
    private static final int MAX_PLAYER_AGE = 50;
    private static final int MAX_REASONABLE_SCORE = 200;
    
    public ValidationResult validateTeam(Team team) {
<span class="nc" id="L31">        List&lt;String&gt; errors = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L32">        List&lt;String&gt; warnings = new ArrayList&lt;&gt;();</span>
        
<span class="nc bnc" id="L34" title="All 2 branches missed.">        if (team == null) {</span>
<span class="nc" id="L35">            errors.add(&quot;Team object is null&quot;);</span>
<span class="nc" id="L36">            return new ValidationResult(false, errors, warnings);</span>
        }
        
        // Required field validations
<span class="nc bnc" id="L40" title="All 4 branches missed.">        if (team.getTeamId() == null || team.getTeamId().trim().isEmpty()) {</span>
<span class="nc" id="L41">            errors.add(&quot;Team ID is required&quot;);</span>
        }
        
<span class="nc bnc" id="L44" title="All 4 branches missed.">        if (team.getName() == null || team.getName().trim().isEmpty()) {</span>
<span class="nc" id="L45">            errors.add(&quot;Team name is required&quot;);</span>
        }
        
<span class="nc bnc" id="L48" title="All 4 branches missed.">        if (team.getCity() == null || team.getCity().trim().isEmpty()) {</span>
<span class="nc" id="L49">            errors.add(&quot;Team city is required&quot;);</span>
        }
        
<span class="nc bnc" id="L52" title="All 4 branches missed.">        if (team.getLeague() == null || team.getLeague().trim().isEmpty()) {</span>
<span class="nc" id="L53">            errors.add(&quot;Team league is required&quot;);</span>
        }
        
        // Business rule validations
<span class="nc bnc" id="L57" title="All 2 branches missed.">        if (team.getFounded() != null) {</span>
<span class="nc bnc" id="L58" title="All 2 branches missed.">            if (team.getFounded().isAfter(LocalDate.now())) {</span>
<span class="nc" id="L59">                errors.add(&quot;Team founded date cannot be in the future&quot;);</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">            } else if (team.getFounded().isBefore(LocalDate.of(1850, 1, 1))) {</span>
<span class="nc" id="L61">                warnings.add(&quot;Team founded date seems unusually early: &quot; + team.getFounded());</span>
            }
        }
        
        // Format validations
<span class="nc bnc" id="L66" title="All 4 branches missed.">        if (team.getName() != null &amp;&amp; team.getName().length() &gt; 100) {</span>
<span class="nc" id="L67">            warnings.add(&quot;Team name is unusually long&quot;);</span>
        }
        
<span class="nc bnc" id="L70" title="All 4 branches missed.">        if (team.getCity() != null &amp;&amp; team.getCity().length() &gt; 50) {</span>
<span class="nc" id="L71">            warnings.add(&quot;City name is unusually long&quot;);</span>
        }
        
<span class="nc" id="L74">        return new ValidationResult(errors.isEmpty(), errors, warnings);</span>
    }
    
    public ValidationResult validatePlayer(Player player) {
<span class="nc" id="L78">        List&lt;String&gt; errors = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L79">        List&lt;String&gt; warnings = new ArrayList&lt;&gt;();</span>
        
<span class="nc bnc" id="L81" title="All 2 branches missed.">        if (player == null) {</span>
<span class="nc" id="L82">            errors.add(&quot;Player object is null&quot;);</span>
<span class="nc" id="L83">            return new ValidationResult(false, errors, warnings);</span>
        }
        
        // Required field validations
<span class="nc bnc" id="L87" title="All 4 branches missed.">        if (player.getPlayerId() == null || player.getPlayerId().trim().isEmpty()) {</span>
<span class="nc" id="L88">            errors.add(&quot;Player ID is required&quot;);</span>
        }
        
<span class="nc bnc" id="L91" title="All 4 branches missed.">        if (player.getName() == null || player.getName().trim().isEmpty()) {</span>
<span class="nc" id="L92">            errors.add(&quot;Player name is required&quot;);</span>
        }
        
<span class="nc bnc" id="L95" title="All 4 branches missed.">        if (player.getTeamId() == null || player.getTeamId().trim().isEmpty()) {</span>
<span class="nc" id="L96">            errors.add(&quot;Player team ID is required&quot;);</span>
        }
        
<span class="nc bnc" id="L99" title="All 4 branches missed.">        if (player.getPosition() == null || player.getPosition().trim().isEmpty()) {</span>
<span class="nc" id="L100">            errors.add(&quot;Player position is required&quot;);</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">        } else if (!VALID_POSITIONS.contains(player.getPosition().trim())) {</span>
<span class="nc" id="L102">            warnings.add(&quot;Unknown player position: &quot; + player.getPosition());</span>
        }
        
<span class="nc bnc" id="L105" title="All 2 branches missed.">        if (player.getAge() == null) {</span>
<span class="nc" id="L106">            errors.add(&quot;Player age is required&quot;);</span>
        } else {
<span class="nc bnc" id="L108" title="All 2 branches missed.">            if (player.getAge() &lt; MIN_PLAYER_AGE) {</span>
<span class="nc" id="L109">                errors.add(&quot;Player age is too young: &quot; + player.getAge());</span>
<span class="nc bnc" id="L110" title="All 2 branches missed.">            } else if (player.getAge() &gt; MAX_PLAYER_AGE) {</span>
<span class="nc" id="L111">                warnings.add(&quot;Player age seems unusually high: &quot; + player.getAge());</span>
            }
        }
        
        // Statistics validation
<span class="nc bnc" id="L116" title="All 2 branches missed.">        if (player.getStatistics() != null) {</span>
<span class="nc" id="L117">            Player.PlayerStatistics stats = player.getStatistics();</span>
            
<span class="nc bnc" id="L119" title="All 4 branches missed.">            if (stats.getGamesPlayed() != null &amp;&amp; stats.getGamesPlayed() &lt; 0) {</span>
<span class="nc" id="L120">                errors.add(&quot;Games played cannot be negative&quot;);</span>
            }
            
<span class="nc bnc" id="L123" title="All 4 branches missed.">            if (stats.getPoints() != null &amp;&amp; stats.getPoints() &lt; 0) {</span>
<span class="nc" id="L124">                errors.add(&quot;Points cannot be negative&quot;);</span>
            }
            
<span class="nc bnc" id="L127" title="All 4 branches missed.">            if (stats.getAssists() != null &amp;&amp; stats.getAssists() &lt; 0) {</span>
<span class="nc" id="L128">                errors.add(&quot;Assists cannot be negative&quot;);</span>
            }
            
            // Cross-field validations
<span class="nc bnc" id="L132" title="All 4 branches missed.">            if (stats.getGamesPlayed() != null &amp;&amp; stats.getGamesPlayed() == 0) {</span>
<span class="nc bnc" id="L133" title="All 4 branches missed.">                if ((stats.getPoints() != null &amp;&amp; stats.getPoints() &gt; 0) ||</span>
<span class="nc bnc" id="L134" title="All 4 branches missed.">                    (stats.getAssists() != null &amp;&amp; stats.getAssists() &gt; 0)) {</span>
<span class="nc" id="L135">                    warnings.add(&quot;Player has statistics but no games played&quot;);</span>
                }
            }
        }
        
<span class="nc" id="L140">        return new ValidationResult(errors.isEmpty(), errors, warnings);</span>
    }
    
    public ValidationResult validateGame(Game game) {
<span class="nc" id="L144">        List&lt;String&gt; errors = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L145">        List&lt;String&gt; warnings = new ArrayList&lt;&gt;();</span>
        
<span class="nc bnc" id="L147" title="All 2 branches missed.">        if (game == null) {</span>
<span class="nc" id="L148">            errors.add(&quot;Game object is null&quot;);</span>
<span class="nc" id="L149">            return new ValidationResult(false, errors, warnings);</span>
        }
        
        // Required field validations
<span class="nc bnc" id="L153" title="All 4 branches missed.">        if (game.getGameId() == null || game.getGameId().trim().isEmpty()) {</span>
<span class="nc" id="L154">            errors.add(&quot;Game ID is required&quot;);</span>
        }
        
<span class="nc bnc" id="L157" title="All 4 branches missed.">        if (game.getHomeTeamId() == null || game.getHomeTeamId().trim().isEmpty()) {</span>
<span class="nc" id="L158">            errors.add(&quot;Home team ID is required&quot;);</span>
        }
        
<span class="nc bnc" id="L161" title="All 4 branches missed.">        if (game.getAwayTeamId() == null || game.getAwayTeamId().trim().isEmpty()) {</span>
<span class="nc" id="L162">            errors.add(&quot;Away team ID is required&quot;);</span>
        }
        
<span class="nc bnc" id="L165" title="All 2 branches missed.">        if (game.getDate() == null) {</span>
<span class="nc" id="L166">            errors.add(&quot;Game date is required&quot;);</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">        } else if (game.getDate().isBefore(LocalDateTime.of(1900, 1, 1, 0, 0))) {</span>
<span class="nc" id="L168">            warnings.add(&quot;Game date seems unusually early: &quot; + game.getDate());</span>
        }
        
<span class="nc bnc" id="L171" title="All 4 branches missed.">        if (game.getStatus() == null || game.getStatus().trim().isEmpty()) {</span>
<span class="nc" id="L172">            errors.add(&quot;Game status is required&quot;);</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">        } else if (!VALID_GAME_STATUSES.contains(game.getStatus().trim())) {</span>
<span class="nc" id="L174">            warnings.add(&quot;Unknown game status: &quot; + game.getStatus());</span>
        }
        
        // Business rule validations
<span class="nc bnc" id="L178" title="All 4 branches missed.">        if (game.getHomeTeamId() != null &amp;&amp; game.getAwayTeamId() != null &amp;&amp;</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">            game.getHomeTeamId().equals(game.getAwayTeamId())) {</span>
<span class="nc" id="L180">            errors.add(&quot;Home team and away team cannot be the same&quot;);</span>
        }
        
        // Score validations
<span class="nc bnc" id="L184" title="All 4 branches missed.">        if (game.getHomeScore() != null &amp;&amp; game.getHomeScore() &lt; 0) {</span>
<span class="nc" id="L185">            errors.add(&quot;Home score cannot be negative&quot;);</span>
        }
        
<span class="nc bnc" id="L188" title="All 4 branches missed.">        if (game.getAwayScore() != null &amp;&amp; game.getAwayScore() &lt; 0) {</span>
<span class="nc" id="L189">            errors.add(&quot;Away score cannot be negative&quot;);</span>
        }
        
<span class="nc bnc" id="L192" title="All 4 branches missed.">        if (game.getHomeScore() != null &amp;&amp; game.getHomeScore() &gt; MAX_REASONABLE_SCORE) {</span>
<span class="nc" id="L193">            warnings.add(&quot;Home score seems unusually high: &quot; + game.getHomeScore());</span>
        }
        
<span class="nc bnc" id="L196" title="All 4 branches missed.">        if (game.getAwayScore() != null &amp;&amp; game.getAwayScore() &gt; MAX_REASONABLE_SCORE) {</span>
<span class="nc" id="L197">            warnings.add(&quot;Away score seems unusually high: &quot; + game.getAwayScore());</span>
        }
        
        // Status-score consistency validation
<span class="nc bnc" id="L201" title="All 2 branches missed.">        if (&quot;Final&quot;.equals(game.getStatus())) {</span>
<span class="nc bnc" id="L202" title="All 4 branches missed.">            if (game.getHomeScore() == null || game.getAwayScore() == null) {</span>
<span class="nc" id="L203">                warnings.add(&quot;Final game should have both scores recorded&quot;);</span>
            }
<span class="nc bnc" id="L205" title="All 2 branches missed.">        } else if (&quot;Scheduled&quot;.equals(game.getStatus())) {</span>
<span class="nc bnc" id="L206" title="All 4 branches missed.">            if (game.getHomeScore() != null || game.getAwayScore() != null) {</span>
<span class="nc" id="L207">                warnings.add(&quot;Scheduled game should not have scores&quot;);</span>
            }
        }
        
<span class="nc" id="L211">        return new ValidationResult(errors.isEmpty(), errors, warnings);</span>
    }
    
    public static class ValidationResult {
        private final boolean valid;
        private final List&lt;String&gt; errors;
        private final List&lt;String&gt; warnings;
        
<span class="nc" id="L219">        public ValidationResult(boolean valid, List&lt;String&gt; errors, List&lt;String&gt; warnings) {</span>
<span class="nc" id="L220">            this.valid = valid;</span>
<span class="nc" id="L221">            this.errors = new ArrayList&lt;&gt;(errors);</span>
<span class="nc" id="L222">            this.warnings = new ArrayList&lt;&gt;(warnings);</span>
<span class="nc" id="L223">        }</span>
        
        public boolean isValid() {
<span class="nc" id="L226">            return valid;</span>
        }
        
        public List&lt;String&gt; getErrors() {
<span class="nc" id="L230">            return new ArrayList&lt;&gt;(errors);</span>
        }
        
        public List&lt;String&gt; getWarnings() {
<span class="nc" id="L234">            return new ArrayList&lt;&gt;(warnings);</span>
        }
        
        public boolean hasWarnings() {
<span class="nc bnc" id="L238" title="All 2 branches missed.">            return !warnings.isEmpty();</span>
        }
        
        public int getErrorCount() {
<span class="nc" id="L242">            return errors.size();</span>
        }
        
        public int getWarningCount() {
<span class="nc" id="L246">            return warnings.size();</span>
        }
        
        @Override
        public String toString() {
<span class="nc" id="L251">            return &quot;ValidationResult{&quot; +</span>
                    &quot;valid=&quot; + valid +
<span class="nc" id="L253">                    &quot;, errors=&quot; + errors.size() +</span>
<span class="nc" id="L254">                    &quot;, warnings=&quot; + warnings.size() +</span>
                    '}';
        }
    }
} 
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>