<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DataCleaner.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Sports Data ETL Pipeline</a> &gt; <a href="index.source.html" class="el_package">com.sportsdata.etl.transformers</a> &gt; <span class="el_source">DataCleaner.java</span></div><h1>DataCleaner.java</h1><pre class="source lang-java linenums">package com.sportsdata.etl.transformers;

import com.sportsdata.etl.models.Game;
import com.sportsdata.etl.models.Player;
import com.sportsdata.etl.models.Team;
import org.apache.commons.lang3.StringUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Component;

import java.util.ArrayList;
import java.util.LinkedHashSet;
import java.util.List;
import java.util.Set;

@Component
<span class="nc" id="L17">public class DataCleaner {</span>
    
<span class="nc" id="L19">    private static final Logger logger = LoggerFactory.getLogger(DataCleaner.class);</span>
    
    public List&lt;Team&gt; cleanTeams(List&lt;Team&gt; teams) {
<span class="nc bnc" id="L22" title="All 4 branches missed.">        if (teams == null || teams.isEmpty()) {</span>
<span class="nc" id="L23">            logger.info(&quot;No teams to clean&quot;);</span>
<span class="nc" id="L24">            return new ArrayList&lt;&gt;();</span>
        }
        
<span class="nc" id="L27">        logger.info(&quot;Starting data cleaning for {} teams&quot;, teams.size());</span>
        
<span class="nc" id="L29">        List&lt;Team&gt; cleanedTeams = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L30">        Set&lt;String&gt; seenTeamIds = new LinkedHashSet&lt;&gt;();</span>
<span class="nc" id="L31">        int duplicateCount = 0;</span>
        
<span class="nc bnc" id="L33" title="All 2 branches missed.">        for (Team team : teams) {</span>
<span class="nc bnc" id="L34" title="All 2 branches missed.">            if (team == null) {</span>
<span class="nc" id="L35">                continue;</span>
            }
            
            // Remove duplicates based on team ID
<span class="nc bnc" id="L39" title="All 2 branches missed.">            if (seenTeamIds.contains(team.getTeamId())) {</span>
<span class="nc" id="L40">                duplicateCount++;</span>
<span class="nc" id="L41">                logger.debug(&quot;Duplicate team found and removed: {}&quot;, team.getTeamId());</span>
<span class="nc" id="L42">                continue;</span>
            }
            
            // Clean team data
<span class="nc" id="L46">            Team cleanedTeam = cleanTeam(team);</span>
<span class="nc bnc" id="L47" title="All 2 branches missed.">            if (cleanedTeam != null) {</span>
<span class="nc" id="L48">                cleanedTeams.add(cleanedTeam);</span>
<span class="nc" id="L49">                seenTeamIds.add(cleanedTeam.getTeamId());</span>
            }
<span class="nc" id="L51">        }</span>
        
<span class="nc" id="L53">        logger.info(&quot;Team cleaning completed: {} cleaned, {} duplicates removed&quot;, </span>
<span class="nc" id="L54">            cleanedTeams.size(), duplicateCount);</span>
        
<span class="nc" id="L56">        return cleanedTeams;</span>
    }
    
    private Team cleanTeam(Team team) {
<span class="nc bnc" id="L60" title="All 2 branches missed.">        if (team == null) {</span>
<span class="nc" id="L61">            return null;</span>
        }
        
        // Clean string fields
<span class="nc" id="L65">        String cleanedName = cleanStringField(team.getName());</span>
<span class="nc" id="L66">        String cleanedCity = cleanStringField(team.getCity());</span>
<span class="nc" id="L67">        String cleanedLeague = cleanStringField(team.getLeague());</span>
<span class="nc" id="L68">        String cleanedVenue = cleanStringField(team.getVenue());</span>
        
        // Create cleaned team
<span class="nc" id="L71">        Team cleanedTeam = new Team();</span>
<span class="nc" id="L72">        cleanedTeam.setTeamId(team.getTeamId());</span>
<span class="nc" id="L73">        cleanedTeam.setName(cleanedName);</span>
<span class="nc" id="L74">        cleanedTeam.setCity(cleanedCity);</span>
<span class="nc" id="L75">        cleanedTeam.setLeague(cleanedLeague);</span>
<span class="nc" id="L76">        cleanedTeam.setFounded(team.getFounded());</span>
<span class="nc" id="L77">        cleanedTeam.setVenue(cleanedVenue);</span>
        
<span class="nc" id="L79">        return cleanedTeam;</span>
    }
    
    public List&lt;Player&gt; cleanPlayers(List&lt;Player&gt; players) {
<span class="nc bnc" id="L83" title="All 4 branches missed.">        if (players == null || players.isEmpty()) {</span>
<span class="nc" id="L84">            logger.info(&quot;No players to clean&quot;);</span>
<span class="nc" id="L85">            return new ArrayList&lt;&gt;();</span>
        }
        
<span class="nc" id="L88">        logger.info(&quot;Starting data cleaning for {} players&quot;, players.size());</span>
        
<span class="nc" id="L90">        List&lt;Player&gt; cleanedPlayers = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L91">        Set&lt;String&gt; seenPlayerIds = new LinkedHashSet&lt;&gt;();</span>
<span class="nc" id="L92">        int duplicateCount = 0;</span>
        
<span class="nc bnc" id="L94" title="All 2 branches missed.">        for (Player player : players) {</span>
<span class="nc bnc" id="L95" title="All 2 branches missed.">            if (player == null) {</span>
<span class="nc" id="L96">                continue;</span>
            }
            
            // Remove duplicates based on player ID
<span class="nc bnc" id="L100" title="All 2 branches missed.">            if (seenPlayerIds.contains(player.getPlayerId())) {</span>
<span class="nc" id="L101">                duplicateCount++;</span>
<span class="nc" id="L102">                logger.debug(&quot;Duplicate player found and removed: {}&quot;, player.getPlayerId());</span>
<span class="nc" id="L103">                continue;</span>
            }
            
            // Clean player data
<span class="nc" id="L107">            Player cleanedPlayer = cleanPlayer(player);</span>
<span class="nc bnc" id="L108" title="All 2 branches missed.">            if (cleanedPlayer != null) {</span>
<span class="nc" id="L109">                cleanedPlayers.add(cleanedPlayer);</span>
<span class="nc" id="L110">                seenPlayerIds.add(cleanedPlayer.getPlayerId());</span>
            }
<span class="nc" id="L112">        }</span>
        
<span class="nc" id="L114">        logger.info(&quot;Player cleaning completed: {} cleaned, {} duplicates removed&quot;, </span>
<span class="nc" id="L115">            cleanedPlayers.size(), duplicateCount);</span>
        
<span class="nc" id="L117">        return cleanedPlayers;</span>
    }
    
    private Player cleanPlayer(Player player) {
<span class="nc bnc" id="L121" title="All 2 branches missed.">        if (player == null) {</span>
<span class="nc" id="L122">            return null;</span>
        }
        
        // Clean string fields
<span class="nc" id="L126">        String cleanedName = cleanStringField(player.getName());</span>
<span class="nc" id="L127">        String cleanedPosition = cleanStringField(player.getPosition());</span>
        
        // Create cleaned player
<span class="nc" id="L130">        Player cleanedPlayer = new Player();</span>
<span class="nc" id="L131">        cleanedPlayer.setPlayerId(player.getPlayerId());</span>
<span class="nc" id="L132">        cleanedPlayer.setName(cleanedName);</span>
<span class="nc" id="L133">        cleanedPlayer.setTeamId(player.getTeamId());</span>
<span class="nc" id="L134">        cleanedPlayer.setPosition(cleanedPosition);</span>
<span class="nc" id="L135">        cleanedPlayer.setAge(player.getAge());</span>
<span class="nc" id="L136">        cleanedPlayer.setStatistics(player.getStatistics());</span>
        
<span class="nc" id="L138">        return cleanedPlayer;</span>
    }
    
    public List&lt;Game&gt; cleanGames(List&lt;Game&gt; games) {
<span class="nc bnc" id="L142" title="All 4 branches missed.">        if (games == null || games.isEmpty()) {</span>
<span class="nc" id="L143">            logger.info(&quot;No games to clean&quot;);</span>
<span class="nc" id="L144">            return new ArrayList&lt;&gt;();</span>
        }
        
<span class="nc" id="L147">        logger.info(&quot;Starting data cleaning for {} games&quot;, games.size());</span>
        
<span class="nc" id="L149">        List&lt;Game&gt; cleanedGames = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L150">        Set&lt;String&gt; seenGameIds = new LinkedHashSet&lt;&gt;();</span>
<span class="nc" id="L151">        int duplicateCount = 0;</span>
        
<span class="nc bnc" id="L153" title="All 2 branches missed.">        for (Game game : games) {</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">            if (game == null) {</span>
<span class="nc" id="L155">                continue;</span>
            }
            
            // Remove duplicates based on game ID
<span class="nc bnc" id="L159" title="All 2 branches missed.">            if (seenGameIds.contains(game.getGameId())) {</span>
<span class="nc" id="L160">                duplicateCount++;</span>
<span class="nc" id="L161">                logger.debug(&quot;Duplicate game found and removed: {}&quot;, game.getGameId());</span>
<span class="nc" id="L162">                continue;</span>
            }
            
            // Clean game data
<span class="nc" id="L166">            Game cleanedGame = cleanGame(game);</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">            if (cleanedGame != null) {</span>
<span class="nc" id="L168">                cleanedGames.add(cleanedGame);</span>
<span class="nc" id="L169">                seenGameIds.add(cleanedGame.getGameId());</span>
            }
<span class="nc" id="L171">        }</span>
        
<span class="nc" id="L173">        logger.info(&quot;Game cleaning completed: {} cleaned, {} duplicates removed&quot;, </span>
<span class="nc" id="L174">            cleanedGames.size(), duplicateCount);</span>
        
<span class="nc" id="L176">        return cleanedGames;</span>
    }
    
    private Game cleanGame(Game game) {
<span class="nc bnc" id="L180" title="All 2 branches missed.">        if (game == null) {</span>
<span class="nc" id="L181">            return null;</span>
        }
        
        // Clean string fields
<span class="nc" id="L185">        String cleanedStatus = cleanStringField(game.getStatus());</span>
        
        // Create cleaned game
<span class="nc" id="L188">        Game cleanedGame = new Game();</span>
<span class="nc" id="L189">        cleanedGame.setGameId(game.getGameId());</span>
<span class="nc" id="L190">        cleanedGame.setHomeTeamId(game.getHomeTeamId());</span>
<span class="nc" id="L191">        cleanedGame.setAwayTeamId(game.getAwayTeamId());</span>
<span class="nc" id="L192">        cleanedGame.setDate(game.getDate());</span>
<span class="nc" id="L193">        cleanedGame.setHomeScore(game.getHomeScore());</span>
<span class="nc" id="L194">        cleanedGame.setAwayScore(game.getAwayScore());</span>
<span class="nc" id="L195">        cleanedGame.setStatus(cleanedStatus);</span>
        
<span class="nc" id="L197">        return cleanedGame;</span>
    }
    
    private String cleanStringField(String value) {
<span class="nc bnc" id="L201" title="All 2 branches missed.">        if (value == null) {</span>
<span class="nc" id="L202">            return null;</span>
        }
        
        // Trim whitespace and normalize
<span class="nc" id="L206">        String cleaned = StringUtils.trim(value);</span>
        
        // Remove extra whitespace between words
<span class="nc" id="L209">        cleaned = StringUtils.normalizeSpace(cleaned);</span>
        
        // Return null if empty after cleaning
<span class="nc bnc" id="L212" title="All 2 branches missed.">        return StringUtils.isEmpty(cleaned) ? null : cleaned;</span>
    }
} 
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>