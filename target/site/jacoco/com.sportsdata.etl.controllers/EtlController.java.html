<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>EtlController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Sports Data ETL Pipeline</a> &gt; <a href="index.source.html" class="el_package">com.sportsdata.etl.controllers</a> &gt; <span class="el_source">EtlController.java</span></div><h1>EtlController.java</h1><pre class="source lang-java linenums">package com.sportsdata.etl.controllers;

import com.sportsdata.etl.loaders.DatabaseLoader;
import com.sportsdata.etl.pipeline.EtlPipeline;
import com.sportsdata.etl.quality.DataQualityChecker;
import com.sportsdata.etl.quality.QualityReport;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.HashMap;
import java.util.Map;

@RestController
@RequestMapping(&quot;/etl&quot;)
@CrossOrigin(origins = &quot;*&quot;)
<span class="nc" id="L19">public class EtlController {</span>
    
<span class="nc" id="L21">    private static final Logger logger = LoggerFactory.getLogger(EtlController.class);</span>
    
    @Autowired
    private EtlPipeline etlPipeline;
    
    @Autowired
    private DataQualityChecker qualityChecker;
    
    @Autowired
    private DatabaseLoader databaseLoader;
    
    @PostMapping(&quot;/execute&quot;)
    public ResponseEntity&lt;EtlPipeline.PipelineResult&gt; executePipeline(
            @RequestBody(required = false) EtlPipeline.PipelineConfig config) {
        
<span class="nc" id="L36">        logger.info(&quot;ETL pipeline execution requested via REST API&quot;);</span>
        
        try {
            // Use default config if none provided
<span class="nc bnc" id="L40" title="All 2 branches missed.">            if (config == null) {</span>
<span class="nc" id="L41">                config = new EtlPipeline.PipelineConfig(</span>
                    &quot;src/main/resources/sample-data/teams.csv&quot;,
                    &quot;src/main/resources/sample-data/players.json&quot;,
                    &quot;src/main/resources/sample-data/games.xml&quot;
                );
            }
            
<span class="nc" id="L48">            EtlPipeline.PipelineResult result = etlPipeline.executeFullPipeline(config);</span>
            
<span class="nc bnc" id="L50" title="All 2 branches missed.">            if (result.isSuccess()) {</span>
<span class="nc" id="L51">                logger.info(&quot;ETL pipeline completed successfully via REST API: {}&quot;, result.getPipelineId());</span>
<span class="nc" id="L52">                return ResponseEntity.ok(result);</span>
            } else {
<span class="nc" id="L54">                logger.error(&quot;ETL pipeline failed via REST API: {}&quot;, result.getErrorMessage());</span>
<span class="nc" id="L55">                return ResponseEntity.internalServerError().body(result);</span>
            }
            
<span class="nc" id="L58">        } catch (Exception e) {</span>
<span class="nc" id="L59">            logger.error(&quot;Unexpected error during ETL pipeline execution&quot;, e);</span>
            
<span class="nc" id="L61">            EtlPipeline.PipelineResult errorResult = new EtlPipeline.PipelineResult(&quot;ERROR&quot;, java.time.LocalDateTime.now());</span>
<span class="nc" id="L62">            errorResult.setSuccess(false);</span>
<span class="nc" id="L63">            errorResult.setErrorMessage(e.getMessage());</span>
<span class="nc" id="L64">            errorResult.setEndTime(java.time.LocalDateTime.now());</span>
            
<span class="nc" id="L66">            return ResponseEntity.internalServerError().body(errorResult);</span>
        }
    }
    
    @GetMapping(&quot;/quality-report&quot;)
    public ResponseEntity&lt;QualityReport&gt; getQualityReport() {
<span class="nc" id="L72">        logger.info(&quot;Data quality report requested via REST API&quot;);</span>
        
        try {
<span class="nc" id="L75">            QualityReport report = qualityChecker.generateQualityReport();</span>
<span class="nc" id="L76">            return ResponseEntity.ok(report);</span>
<span class="nc" id="L77">        } catch (Exception e) {</span>
<span class="nc" id="L78">            logger.error(&quot;Error generating quality report&quot;, e);</span>
<span class="nc" id="L79">            return ResponseEntity.internalServerError().build();</span>
        }
    }
    
    @GetMapping(&quot;/status&quot;)
    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; getPipelineStatus() {
<span class="nc" id="L85">        logger.info(&quot;Pipeline status requested via REST API&quot;);</span>
        
        try {
<span class="nc" id="L88">            Map&lt;String, Object&gt; status = new HashMap&lt;&gt;();</span>
            
            // Get data counts
<span class="nc" id="L91">            long teamCount = databaseLoader.getTeamCount();</span>
<span class="nc" id="L92">            long playerCount = databaseLoader.getPlayerCount();</span>
<span class="nc" id="L93">            long gameCount = databaseLoader.getGameCount();</span>
            
<span class="nc" id="L95">            status.put(&quot;status&quot;, &quot;READY&quot;);</span>
<span class="nc" id="L96">            status.put(&quot;database&quot;, Map.of(</span>
<span class="nc" id="L97">                &quot;teams&quot;, teamCount,</span>
<span class="nc" id="L98">                &quot;players&quot;, playerCount,</span>
<span class="nc" id="L99">                &quot;games&quot;, gameCount,</span>
<span class="nc" id="L100">                &quot;total&quot;, teamCount + playerCount + gameCount</span>
            ));
            
            // Add system info
<span class="nc" id="L104">            status.put(&quot;system&quot;, Map.of(</span>
<span class="nc" id="L105">                &quot;javaVersion&quot;, System.getProperty(&quot;java.version&quot;),</span>
<span class="nc" id="L106">                &quot;availableProcessors&quot;, Runtime.getRuntime().availableProcessors(),</span>
<span class="nc" id="L107">                &quot;maxMemory&quot;, Runtime.getRuntime().maxMemory() / (1024 * 1024) + &quot; MB&quot;,</span>
<span class="nc" id="L108">                &quot;freeMemory&quot;, Runtime.getRuntime().freeMemory() / (1024 * 1024) + &quot; MB&quot;</span>
            ));
            
<span class="nc" id="L111">            return ResponseEntity.ok(status);</span>
<span class="nc" id="L112">        } catch (Exception e) {</span>
<span class="nc" id="L113">            logger.error(&quot;Error getting pipeline status&quot;, e);</span>
<span class="nc" id="L114">            return ResponseEntity.internalServerError().build();</span>
        }
    }
    
    @DeleteMapping(&quot;/data&quot;)
    public ResponseEntity&lt;Map&lt;String, String&gt;&gt; clearAllData() {
<span class="nc" id="L120">        logger.warn(&quot;Data clearing requested via REST API&quot;);</span>
        
        try {
<span class="nc" id="L123">            databaseLoader.clearAllData();</span>
            
<span class="nc" id="L125">            Map&lt;String, String&gt; response = new HashMap&lt;&gt;();</span>
<span class="nc" id="L126">            response.put(&quot;status&quot;, &quot;SUCCESS&quot;);</span>
<span class="nc" id="L127">            response.put(&quot;message&quot;, &quot;All data cleared from database&quot;);</span>
            
<span class="nc" id="L129">            return ResponseEntity.ok(response);</span>
<span class="nc" id="L130">        } catch (Exception e) {</span>
<span class="nc" id="L131">            logger.error(&quot;Error clearing data&quot;, e);</span>
            
<span class="nc" id="L133">            Map&lt;String, String&gt; errorResponse = new HashMap&lt;&gt;();</span>
<span class="nc" id="L134">            errorResponse.put(&quot;status&quot;, &quot;ERROR&quot;);</span>
<span class="nc" id="L135">            errorResponse.put(&quot;message&quot;, e.getMessage());</span>
            
<span class="nc" id="L137">            return ResponseEntity.internalServerError().body(errorResponse);</span>
        }
    }
    
    @GetMapping(&quot;/health&quot;)
    public ResponseEntity&lt;Map&lt;String, String&gt;&gt; healthCheck() {
<span class="nc" id="L143">        Map&lt;String, String&gt; health = new HashMap&lt;&gt;();</span>
<span class="nc" id="L144">        health.put(&quot;status&quot;, &quot;UP&quot;);</span>
<span class="nc" id="L145">        health.put(&quot;application&quot;, &quot;Sports Data ETL Pipeline&quot;);</span>
<span class="nc" id="L146">        health.put(&quot;timestamp&quot;, java.time.LocalDateTime.now().toString());</span>
        
<span class="nc" id="L148">        return ResponseEntity.ok(health);</span>
    }
} 
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>